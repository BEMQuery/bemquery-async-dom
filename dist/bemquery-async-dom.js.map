{"version":3,"file":"bemquery-async-dom.js","sources":["../src/batch.js","../src/utils.js","../src/html.js","../src/state.js"],"sourcesContent":["'use strict';\n\n/** Class storing queue of DOM operations. */\nclass Batch {\n\t/**\n\t * Constructing new batch.\n\t *\n\t * @class\n\t */\n\tconstructor() {\n\t\tthis.read = [];\n\t\tthis.write = [];\n\t}\n\n\t/**\n\t * Add new operation to the batch.\n\t *\n\t * @param {String} type Type of operation. Must be either \"read\" or \"write\".\n\t * @param {Function} fn Operation to be fired.\n\t * @return {BEMQuery} Current BEMQuery instance.\n\t */\n\tadd( type, fn ) {\n\n\t\tif ( type !== 'read' && type !== 'write' ) {\n\t\t\tthrow new TypeError( 'Type must be either \\'read\\' or \\'write\\'.' );\n\t\t}\n\n\t\tif ( typeof fn !== 'function' ) {\n\t\t\tthrow new TypeError( 'Task must be a function.' );\n\t\t}\n\n\t\tthis[ type ].push( fn );\n\t}\n\n\t/**\n\t * Run operations of given type.\n\t *\n\t * @param {String} type Type of operations to run. Must be either \"read\" or \"write\".\n\t * @return {Promise} Promise that will be fulfilled after running all tasks.\n\t */\n\trun( type = 'read' ) {\n\t\tif ( type !== 'read' && type !== 'write' ) {\n\t\t\tthrow new TypeError( 'Type must be either \\'read\\' or \\'write\\'.' );\n\t\t}\n\n\t\treturn new Promise( ( resolve ) => {\n\t\t\trequestAnimationFrame( () => {\n\t\t\t\tconst results = [];\n\n\t\t\t\tthis[ type ].forEach( ( fn ) => {\n\t\t\t\t\tresults.push( fn() );\n\t\t\t\t} );\n\n\t\t\t\tthis[ type ] = [];\n\n\t\t\t\treturn resolve( results );\n\t\t\t} );\n\t\t} );\n\t}\n}\n\nexport default Batch;\n","'use strict';\n\nimport { BEMQuery as BEMQuery } from 'bemquery-core';\nimport Batch from './batch';\n\n/**\n * Method that runs all read operations stored in batch\n *\n * @return {Promise} Promise returned by batch.\n * @memberof BEMQuery\n */\nBEMQuery.prototype.read = function() {\n\tif ( !this.batch ) {\n\t\tthis.batch = new Batch();\n\t}\n\n\treturn this.batch.run( 'read' );\n};\n\n/**\n * Method that runs all write operations stored in batch\n *\n * @return {Promise} Promise returned by batch.\n * @memberof BEMQuery\n */\nBEMQuery.prototype.write = function() {\n\tif ( !this.batch ) {\n\t\tthis.batch = new Batch();\n\t}\n\n\treturn this.batch.run( 'write' );\n};\n","'use strict';\n\nimport { BEMQuery as BEMQuery } from 'bemquery-core';\nimport Batch from './batch';\n\n/**\n * Method for getting/setting inner HTML of all elements in collection\n *\n * @param {String} [newHTML] The new inner HTML value. If not specified,\n * the method will work as getter.\n * @return {BEMQuery} Current BEMQuery instance.\n * @memberof BEMQuery\n */\nBEMQuery.prototype.html = function( newHTML ) {\n\tif ( !this.batch ) {\n\t\tthis.batch = new Batch();\n\t}\n\n\tif ( typeof newHTML !== 'undefined' ) {\n\t\tnewHTML = String( newHTML );\n\n\t\tthis.batch.add( 'write', () => {\n\t\t\tconst elements = this.elements;\n\n\t\t\telements.forEach( ( element ) => {\n\t\t\t\telement.innerHTML = newHTML;\n\t\t\t} );\n\t\t} );\n\t} else {\n\t\tthis.batch.add( 'read', () => {\n\t\t\tconst elements = this.elements;\n\t\t\tconst htmls = [];\n\n\t\t\telements.forEach( ( element ) => {\n\t\t\t\thtmls.push( element.innerHTML );\n\t\t\t} );\n\n\t\t\treturn htmls;\n\t\t} );\n\t}\n\n\treturn this;\n};\n","'use strict';\n\nimport { BEMQuery as BEMQuery } from 'bemquery-core';\nimport Batch from './batch';\n\nfunction processClasses( converter, element ) {\n\tconst states = [];\n\n\t[].forEach.call( element.classList, ( className ) => {\n\t\tconst state = converter.getStateFromClass( String( className ) );\n\n\t\tif ( state ) {\n\t\t\tstates.push( state );\n\t\t}\n\t} );\n\n\treturn states;\n}\n\n/**\n * Method for getting states from all elements in collection.\n *\n * @return {BEMQuery} Current BEMQuery instance.\n * @memberof BEMQuery\n */\nBEMQuery.prototype.getStates = function() {\n\tif ( !this.batch ) {\n\t\tthis.batch = new Batch();\n\t}\n\n\tconst elements = this.elements;\n\n\tthis.batch.add( 'read', () => {\n\t\tconst result = [];\n\n\t\telements.forEach( ( element ) => {\n\t\t\tresult.push( processClasses( this.converter, element ) );\n\t\t} );\n\n\t\treturn result;\n\t} );\n\n\treturn this;\n};\n"],"names":["Batch","constructor","read","write","add","type","fn","TypeError","push","run","Promise","resolve","requestAnimationFrame","results","forEach","BEMQuery","prototype","batch","html","newHTML","elements","htmls","element","innerHTML","processClasses","converter","states","call","classList","className","state","getStateFromClass","getStates","result"],"mappings":"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"}